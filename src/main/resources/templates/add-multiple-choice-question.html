<!DOCTYPE html>
<html lang="fa" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Ø§ÙØ²ÙˆØ¯Ù† Ø³ÙˆØ§Ù„ Ú†Ù†Ø¯ Ú¯Ø²ÛŒÙ†Ù‡â€ŒØ§ÛŒ</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <script>
        let optionIndex = 0;

        function addOption() {
            const input = document.getElementById("optionText");
            const text = input.value.trim();

            if (!text) return;

            const list = document.getElementById("optionsList");

            const div = document.createElement("div");
            div.className = "form-check mb-2";

            div.innerHTML = `
                <input class="form-check-input"
                       type="radio"
                       name="correctOption"
                       value="${optionIndex}"
                       required>
                <label class="form-check-label">
                    ${text}
                </label>
                <input type="hidden"
                       name="options[${optionIndex}].text"
                       value="${text}">
            `;

            list.appendChild(div);
            optionIndex++;
            input.value = "";
            updateOptionCount();
        }

        function updateOptionCount() {
            document.getElementById("optionCount").value = optionIndex;
        }

        function validateForm() {
            if (optionIndex < 2) {
                alert("Ø³ÙˆØ§Ù„ Ú†Ù†Ø¯ Ú¯Ø²ÛŒÙ†Ù‡â€ŒØ§ÛŒ Ø¨Ø§ÛŒØ¯ Ø­Ø¯Ø§Ù‚Ù„ Û² Ú¯Ø²ÛŒÙ†Ù‡ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯");
                return false;
            }
            return true;
        }
    </script>
</head>
<body class="bg-light">

<div class="container mt-5">
    <div class="card shadow-sm">
        <div class="card-body">

            <h4 class="mb-4">â• Ø§ÙØ²ÙˆØ¯Ù† Ø³ÙˆØ§Ù„ Ú†Ù†Ø¯ Ú¯Ø²ÛŒÙ†Ù‡â€ŒØ§ÛŒ</h4>

            <!-- ====== MESSAGES ====== -->
            <div th:if="${addNewMultipleChoiceSuccess}" class="alert alert-success text-center">
                <span th:text="${addNewMultipleChoiceSuccess}"></span>
            </div>

            <form method="post"
                  th:action="@{'/course/' + ${courseCode} + '/exam/' + ${examCode} + '/question/multipleChoice/new/'}"
                  onsubmit="return validateForm()">

                <input type="hidden" name="questionType" value="MULTIPLE_CHOICE">


                <!-- Ø¹Ù†ÙˆØ§Ù† -->
                <div class="mb-3">
                    <label class="form-label">Ø¹Ù†ÙˆØ§Ù† Ø³ÙˆØ§Ù„</label>
                    <input type="text" name="title" class="form-control" required>
                </div>

                <!-- Ù…ØªÙ† -->
                <div class="mb-3">
                    <label class="form-label">Ù…ØªÙ† Ø³ÙˆØ§Ù„</label>
                    <textarea name="text" class="form-control" rows="3" required></textarea>
                </div>

                <!-- course / exam -->
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Ú©Ø¯ Ø¯Ø±Ø³</label>
                        <input type="text" name="courseCode"
                               class="form-control"
                               th:value="${courseCode}" readonly>
                    </div>

                    <div class="col-md-6 mb-3">
                        <label class="form-label">Ú©Ø¯ Ø¢Ø²Ù…ÙˆÙ†</label>
                        <input type="text" name="examCode"
                               class="form-control"
                               th:value="${examCode}" readonly>
                    </div>
                </div>

                <!-- score -->
                <div class="mb-3">
                    <label class="form-label">Ù†Ù…Ø±Ù‡ Ø³ÙˆØ§Ù„</label>
                    <select name="score" class="form-select" required>
                        <option value="">Ø§Ù†ØªØ®Ø§Ø¨ Ù†Ù…Ø±Ù‡</option>
                        <option th:each="i : ${#numbers.sequence(1,16)}"
                                th:value="${i * 0.25}"
                                th:text="${i * 0.25}">
                        </option>
                    </select>
                </div>

                <!-- options -->
                <hr>

                <div class="mb-3">
                    <label class="form-label">Ø§ÙØ²ÙˆØ¯Ù† Ú¯Ø²ÛŒÙ†Ù‡</label>
                    <div class="input-group">
                        <input type="text" id="optionText" class="form-control">
                        <button type="button"
                                class="btn btn-success"
                                onclick="addOption()">â•
                        </button>
                    </div>
                </div>

                <div class="mb-4">
                    <label class="form-label">Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§</label>
                    <div id="optionsList" class="border rounded p-3"></div>
                </div>

                <!-- buttons -->
                <div class="d-flex gap-2">
                    <button type="submit" class="btn btn-primary w-100">
                        ğŸ’¾ Ø§ÙØ²ÙˆØ¯Ù† Ø³ÙˆØ§Ù„
                    </button>

                    <a class="btn btn-outline-secondary w-100"
                       th:href="@{'/course/' + ${courseCode}
                    + '/exams/edit/' + ${examCode}}">
                        â¬… Ø¨Ø§Ø²Ú¯Ø´Øª
                    </a>
                </div>

            </form>


        </div>
    </div>
</div>

</body>
</html>
